import 'package:flutte_json_heacker_news/json_parsing.dart';
import 'package:test_api/test_api.dart';
import 'package:http/http.dart' as http;

void main() {
  /* test("parses topstories.json", () {
    const jsonString =
        "[19074299,19072850,19073851,19074512,19062501,19072433,19072700,19074089,19073433,19072078,19072680,19074170,19072941,19068865,19069047,19071751,19069440,19065722,19073222,19072341,19060764,19072914,19071835,19072769,19073538,19068465,19070511,19071604,19070448,19074313,19063053,19069312,19050927,19070438,19070632,19068304,19071221,19070114,19073273,19070733,19061491,19063727,19073295,19070547,19071598,19062414,19069042,19066521,19069560,19072933,19068359,19069553,19071392,19072186,19072980,19072307,19072284,19067302,19073771,19069365,19069671,19070295,19069450,19068017,19062304,19071693,19070316,19067190,19061303,19072383,19073950,19071449,19069018,19074173,19061483,19070715,19071779,19071646,19069856,19062667,19072420,19068008,19054466,19055994,19062671,19063540,19072600,19071050,19058702,19069171,19071192,19072093,19062319,19064791,19071944,19069349,19066366,19067027,19069526,19071054,19071028,19055166,19060502,19066204,19068665,19070131,19070172,19065682,19050955,19068269,19052011,19059125,19057007,19064069,19071226,19062544,19065116,19052688,19062351,19070754,19066951,19059805,19070593,19055119,19071769,19065859,19072329,19070221,19060487,19070747,19067252,19049479,19061690,19057673,19050509,19062285,19049834,19069566,19060699,19070335,19063977,19060394,19052830,19057848,19051914,19056808,19060608,19066203,19061460,19062514,19052587,19066033,19047384,19070794,19054440,19052817,19062349,19051435,19069544,19048204,19071357,19061034,19069320,19071755,19068506,19063829,19060256,19073083,19068089,19069221,19067661,19063064,19062261,19065814,19063711,19069080,19067565,19065236,19057604,19061656,19055312,19062407,19060043,19054558,19069995,19046468,19056253,19066122,19060748,19052062,19070073,19057331,19060678,19060302,19065461,19047530,19050998,19062042,19062707,19057277,19058382,19054358,19065635,19048849,19057643,19073281,19065791,19068452,19046259,19070126,19062737,19046475,19061745,19062674,19059674,19073220,19070532,19071345,19046826,19057623,19046952,19058713,19046238,19060407,19050681,19067164,19046461,19061113,19057683,19063548,19048946,19058971,19060510,19049448,19073319,19056656,19062595,19070789,19070786,19064382,19059118,19062253,19054501,19059028,19058108,19054398,19064316,19047096,19067270,19065259,19060523,19046108,19059719,19055165,19047503,19051415,19060069,19062638,19063446,19060491,19050073,19048126,19053275,19066622,19066610,19062531,19054932,19061135,19060985,19056805,19051866,19059120,19067077,19057146,19047447,19061679,19064093,19062791,19054150,19066088,19065358,19053724,19056911,19051604,19051541,19050482,19048218,19069159,19054544,19045578,19048976,19068057,19068986,19060433,19061871,19066206,19050102,19054136,19064257,19048108,19062433,19061662,19055164,19057742,19046289,19048787,19046131,19061344,19047620,19047609,19068599,19069448,19068106,19051205,19067337,19050738,19061374,19057514,19066233,19062368,19068378,19060683,19063219,19056698,19067925,19061217,19050807,19062963,19061797,19061784,19059109,19054576,19058329,19049384,19061487,19052901,19066849,19046756,19066738,19067135,19063953,19051438,19063638,19049053,19051080,19054685,19051433,19051275,19051222,19046852,19061542,19059034,19063958,19065250,19061323,19056974,19066581,19050609,19064983,19066417,19055677,19051326,19063756,19067629,19046000,19052931,19070016,19050240,19048880,19065138,19068962,19053628,19048571,19053153,19058057,19057862,19047589,19066828,19052964,19072677,19045999,19055694,19060420,19067808,19063690,19050710,19055562,19061105,19051145,19063398,19050121,19057451,19051332,19055182,19060596,19062840,19050737,19045757,19050140,19060185,19061401,19053183,19065089,19059959,19062435,19064875,19051093,19055570,19060712,19061969,19047093,19052481,19051367,19059973,19047293,19049251,19059503,19064778,19063103,19050616,19048297,19061123,19049956,19053226,19047314,19059180,19062402,19062250,19051487,19046074,19049025,19051098,19052590,19056993,19048943,19055734,19053775,19061812,19058959,19061735,19051872,19065759,19045822,19053444,19045817,19057058,19050775,19053318,19050388,19046322,19054026,19060056,19059753,19059735,19063309,19059428,19052952,19050273,19052831,19058701,19052321,19057122,19056890,19056826,19051570,19055805,19053642,19045918,19050497,19050442,19065379,19049946,19052987,19063946,19052119,19051889,19052198,19062491,19066090,19051188,19046125,19064668,19045970,19059662,19059655,19054314,19061677,19056580,19047222,19054343,19052230,19073327,19064860,19054535,19059577,19053409,19062504,19058750,19050159,19065256]";
    expect(parseTopStories(jsonString).first, 19074299);
  });*/

  test("parses items.json", () {
    const jsonString =
        """{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8952,8917,8884,8887,8869,8940,8908,8958,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}""";
    expect(parseArticle(jsonString).id, 8863);
  });

  test("parses item.json over a network", () async {
    final url = 'https://hacker-news.firebaseio.com/v0/beststories.json';
    final res = await http.get(url);
    if (res.statusCode == 200) {
      final idList = parseTopStories(res.body);
      if (idList.isNotEmpty) {
        final storyUrl =
            'https://hacker-news.firebaseio.com/v0/item/${idList.first}.json';
        final storyRes = await http.get(storyUrl);
        if (res.statusCode == 200) {
          expect(parseArticle(storyRes.body), isNotNull);
        }
      }
    }
  }, skip: true);
}
